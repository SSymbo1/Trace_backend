<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.hrbu.trace_backend.mapper.EntranceMapper">

    <resultMap id="entranceResult" type="edu.hrbu.trace_backend.entity.po.Entrance">
        <id column="eid" property="eid"/>
        <result column="enterprise_code" property="enterpriseCode"/>
        <result column="enterprise_name" property="enterpriseName"/>
        <result column="business_time" property="businessTime"/>
        <result column="name" property="name"/>
        <result column="code" property="code"/>
        <result column="batch" property="batch"/>
        <result column="num" property="num"/>
        <result column="unit" property="unit"/>
        <result column="trace" property="trace"/>
        <result column="buyer_type" property="buyerType"/>
        <result column="class_name" property="className"/>
    </resultMap>

    <select id="selectEntranceInfoByCondition" resultMap="entranceResult">
        SELECT
            entrance.eid,
            enterprise.social_code      AS enterprise_code,
            entrance.business_time,
            entrance.name,
            entrance.code,
            entrance.batch,
            entrance.num,
            entrance.unit,
            entrance.trace,
            entrance.buyer_type,
            classification.name         AS class_name,
            enterprise.name             AS enterprise_name,
            entrance.buyer_type
        FROM entrance
        JOIN classification On classification.cid = entrance.cid
        JOIN enterprise ON enterprise.eid = entrance.bid
        <where>
            1 = 1
            <if test="condition.name != null and condition.name != ''">
                AND entrance.name LIKE CONCAT('%',#{condition.name},'%') OR entrance.code LIKE CONCAT('%',#{condition.name},'%')
            </if>
            <if test="condition.batch != null and condition.batch != ''">
                AND entrance.batch LIKE CONCAT('%',#{condition.batch},'%')
            </if>
            <if test="condition.trace != null and condition.trace != ''">
                AND entrance.trace LIKE CONCAT('%',#{condition.trace},'%')
            </if>
            <if test="condition.buyerType != null and condition.buyerType != ''">
                AND entrance.buyer_type = #{condition.buyerType}
            </if>
        </where>
    </select>

</mapper>
